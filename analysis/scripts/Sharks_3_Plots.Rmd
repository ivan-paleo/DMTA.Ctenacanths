---
title: "Plots for the dataset of DMTA on Devionan sharks"
author: "Ivan Calandra"
date: "`r format(Sys.time(), usetz = TRUE)`"
output:
  html_document:
    toc: true
    toc_depth: 3
    toc_float: true
    theme: cerulean
    highlight: pygments
    number_sections: true
  github_document: 
    toc: true
    toc_depth: 3
    html_preview: false
bibliography: Sharks_3_Plots.bib
knit: (function(inputFile, encoding) {
  rmarkdown::render(inputFile, encoding = encoding, output_format = "all", knit_root_dir = rprojroot::find_rstudio_root_file()) })
---

```{r Knitr Options, include = FALSE}
knitr::opts_chunk$set(comment = NA, message = FALSE, indent = "", error = TRUE)
```


---


# Goal of the script
The script plots all SSFA variables for the Devonian shark dataset.   

```{r}
dir_in  <- "analysis/derived_data"
dir_out <- "analysis/plots"
```

Input Rbin data file must be located in "`r paste0("./", dir_in)`".  
Plots will be saved in "`r paste0("./", dir_out)`".

The knit directory for this script is the project directory.


---


# Load packages
```{r}
pack_to_load <- c("ggplot2", "grateful", "knitr", "R.utils", "RColorBrewer", "rmarkdown", "tidyverse")
sapply(pack_to_load, library, character.only = TRUE, logical.return = TRUE)
```


---


# Read in data
## Get name and path of input file 
```{r}
info_in <- list.files(dir_in, pattern = "\\.Rbin$", full.names = TRUE)
info_in
```


## Read in Rbin file
```{r}
sharks <- loadObject(info_in)
str(sharks)
```


---


# Exclude surfaces with NMP ≥ 20%
Surfaces with more than 20% NMP should not be analyzed.

```{r}
sharks_nmp0_20 <- filter(sharks, NMP_cat != "≥20%")
sharks_nmp0_20$NMP_cat <- factor(sharks_nmp0_20$NMP_cat)
str(sharks_nmp0_20)
```


---


# Plot each surface parameter in a boxplot
## Define variables
Here we define which columns are used for the boxplots.  

```{r}
# Column to be used to group on the x-axis
x_var <- "Specimen"

# Columns to be used on the y-axis
y_ISO_height <- colnames(sharks)[8:13] 
y_ISO_vol <- colnames(sharks)[24:29] 
y_ISO_others <- colnames(sharks)[14:23] 
y_furrow_diriso <- colnames(sharks)[30:36]
y_SSFA <- colnames(sharks)[37:42]

# colors
grp_colors <- "Tooth"

# shapes
grp_shapes <- "NMP_cat"
```


## Plotting function
```{r}
custom_boxplot <- function(){
  
  
}
```


## Pivot to longer format for facet plots
```{r}
data_long <- select(sharks_nmp0_20, all_of(c(x_var, y_var, grp_colors, grp_shapes))) %>%
             pivot_longer(all_of(y_var), names_to = "parameter", values_to = "value")
str(data_long)
head(data_long)
```


## Plot
```{r}
# set up plot
p_box <- ggplot(data_long, aes(x = .data[[x_var]], y = value)) +

         # Boxplots:
         # hide outliers (all points are shown with geom_point() below) 
         geom_boxplot(outlier.shape = NA) +
  
         # Points:
         # Add layers of shapes and colors for points 
         # Jitter points
         geom_point(mapping = aes(shape = .data[[grp_shapes]], color = .data[[grp_colors]]), position = "jitter", size = 2) +
  
         # Remove y-axis label
         labs(y = NULL) + 
  
         # Choose a light theme
         theme_classic() +
  
         # Wrap around parameters (i.e. 1 subplot per parameter) with free y-scales
         facet_wrap(~ parameter, scales = "free_y") +

         # The qualitative 'Set2' palette of RColorBrewer is colorblind friendly
         scale_color_brewer(palette = 'Set2')


# Print plot
print(p_box)
```


## Save plot
```{r}
ggsave(plot = p_box, filename = "DMTA-Ctenacanths_boxplots.pdf", 
       path = dir_out, width = 240, height = 190, units = "mm")
```


---


# Plot anisotropy vs. complexity
## Plot
```{r}
# set up plot
p_bi <- ggplot(sharks_nmp0_20, aes(x = Asfc, y = epLsar)) +
        
        # Scatterplot
        geom_point(mapping = aes(color = .data[[grp_colors]], shape = .data[[grp_shapes]]), size = 4) +
  
        # Adjust axes labels
        labs(x = "Complexity (Asfc)", y = "Anisotropy (epLsar)") +
  
        # The qualitative 'Set2' palette of RColorBrewer is colorblind friendly
        scale_color_brewer(palette = 'Set2') +
  
        # Wrap around Specimen (i.e. 1 subplot per specimen)
        facet_wrap(~ Specimen) +
  
        # Choose a light theme
        theme_classic()


# Print plot
print(p_bi)
```


## Save plot
```{r}
ggsave(plot = p_bi, filename = "DMTA-Ctenacanths__epLsar-Asfc.pdf", 
       path = dir_out, width = 240, height = 190, units = "mm")
```

---


# sessionInfo()

```{r}
sessionInfo()
```


---


# Cite R packages used

```{r, echo = FALSE}
cite_packages(pkgs = c(pack_to_load, "base"), output = "paragraph", 
              include.RStudio = TRUE, out.dir = "analysis/scripts", bib.file = "Sharks_3_Plots")
```


## References

